# [블록체인 무엇인가?](https://book.naver.com/bookdb/book_detail.nhn?bid=13316548)

### 첫째마당: 소프트웨어 공학에서 변하지 않는 주요 개념들.

1. **시스템**은 2가지 관점에서 바라 볼 수 있다. 

   - `응용계층 vs 구현계층`
   - `기능적 측면 vs 비기능적 측면`

2. 응용계층은 사용자의 요구사항에, 구현계층은 요구사항을 실현해 주는 기술적 측면에 중점을 둔다.

3. 기능적 측면은 ‘행위’에, 비기능적 측면은 그 행위를 ‘어떤 식으로 했는가’에 중점을 둔다.

4. 시스템에서 ‘무결성’은 구현계층이면서 비기능적 측면에 해당한다.

5. `무결성`이란 다음의 3가지 구성요소로 이루어져 있다.

   - `데이터무결성`: 데이터는 완전하고 정확하며 모순이 없음.

   - `작동 무결성`: 시스템이 의도한 대로 동작함. 
   - `보안`

6. 시스템을 구현하는 방법으로 `중앙 통제 시스템`과 `분산 시스템`이 있다.

7. `분산 시스템`이란 다수의 독립된 컴퓨터가 중앙 통제나 조정 요소 없이 특정 목적 달성을 위해 통신 매체를 사용해 서로 협력하는 시스템이다.

8. `블록체인`은 분산 시스템, 특히 순수 분산 P2P시스템에서 `무결성`을 확보하고 유지하기 위한 도구이다.


---



### 둘째마당: 왜 우리에게 블록체인이 필요한가?

1. `블록체인`이란 `무결성을 확보하고 유지하기 위해서` 순서에 따라 연결된 블록들의 정보 내용을 `암호화 기법과 보안기술을 이용해 협상하는 알고리즘`으로 구성된 소프트웨어 요소를 활용하는 `원장의 순수 분산 P2P 시스템`을 의미한다. 

2. 비트코인이 블록체인의 전부는 아니다. 비트코인은 블록체인 응용기술의 하나의 형태일 뿐이다. 그러나 소유권을 관리하고 명확하는 가장 중요한 응용사례 중 하나인 것은 맞다. 

3. `원장`은 소유권을 증명하기도 하고 이전하기도 한다. 만일 하나의 원장이 손상되거나 파괴되면 모든 사람들에게 피해가 돌아갈 것이다. 이러한 상황을 방지하기 위해서는 조작될 위험이 있는 원장을 순수 분산 P2P 시스템을 활용해 다수의 노드가 동의하는 진실을 이용해 소유권을 확인하면 된다.

4. 순수 분산 P2P 시스템에서 발생할 수 있는 문제는 `이중사용(double spending)`이다. 이중사용은 아래 예시를 통해 쉽게 이해할 수 있다.

   > A가 B에게 집을 팔았다. A에서 B로의 소유권 이전은 P2P 시스템의 어느 원장에 기록되었다. 이 원장을 관리하는 피어는 그 즉시 다른 피어에게 소유권 이전 사실을 알린다. 이러한 전달 행위는 모든 피어가 A에서 B로 소유권이 이전되었다는 사실을 알게 될 때까지 계속된다. 그 와중에 A가 재빨리 시스템에 있는 다른 원장에 접근해 동일한 집에 대해 A에서 C로의 소유권 이전을 기록하도록 요청했다고 가정해보자. A에서 B로 소유권이 이전된 사실을 아직 모를 경우 피어는 이 요청을 받아들이고 동일한 집에 대한 소유권 이전을 A에서 C로 기록할 것이다. 그러나 B와 C가 동시에 같은 집을 소유할 수는 없다. 둘 중 하나만 새로운 합법적 소유자가 되어야 한다. 바로 이런 상황이 이중사용문제라 불린다.

5. 이중사용이란 모든 노드가 최신 정보로 갱신되기까지 시간이 걸리는 문제로 인해 소유권 정보가 상이한 피어가 발생하는 상황을 말한다. `블록체인`은 이러한 이중사용문제를 해결하는 중요한 도구이다. 

6. 지금까지의 내용을 정리해보면, 블록체인은...

   - 순수 분산 P2P시스템의 무결성을 유지하고 보존하는 도구이며,

   - 순수 분산 P2P시스템에서 발생할 수 있는 이중사용(double spending)문제까지 해결할 수 있다.


---

### 셋째마당: 블록체인은 어떻게 작동하는가?

#### 8단계: 블록체인의 청사진 그리기

- 개발환경: 순수분산 P2P시스템, 인터넷을 통해 개별 노드의 네트워크를 연결, 노드의 개수, 안정성 및 신뢰성을 전혀 알 수 없음. 목표는 디지털 재화의 `소유권 관리`
- 해결 해야할 과제: 9~20단계 내용
  - 소유권 기술(description)
  - 승인받지 않은 접근으로부터 소유권 보호
  - 트랙잭션 데이터 저장
  - 신뢰할 수 없는 환경에 배분할 원장 준비
  - 분산 원장 시스템 형성
  - 새로운 트랜잭션 검증 및 추가하기
  - 진실을 담은 원장 가려내기



#### 9단계: 소유권 기록에서 모든 것이 시작된다: 이력으로 현재 소유권 상태 알아내기

- 트랜잭션 데이터: 현 소유자의 소유권을 다른 사람에게 이전하는 행위와 관련된 데이터. 이전 이력 데이터.
- 현재 소유권 상태에 대한 정보 + 트랜잭션 데이터를 함께 작성하면 소유권의 설명과 더불어 **증명**까지 해준다.
- 블록체인은 모든 트랙잭션이 **'기록 된 순서'**대로 저장하여 전체 이력을 유지한다.



#### 10단계: 데이터 해싱하기: 지문처럼 만들어서 데이터 식별하기.

- `해시함수(hash function)`: 어떤 형태의 데이터든 입력 데이터의 길이와 상관없이 고정된 길이의 해시값(hash value)으로 반환하는 함수.
  - 어떤 종류의 데이터든 즉시 해시값 제공: 해시값을 생성하는데 소요되는 시간이 짧음.
  - 확정적(deterministic): 동일한 입력에 대해 동일한 출력을 보장 함.
  - 의사난수(pseudorandom): 입력 데이터가 아주 조금만 달라져도 해시값이 예측 불가능하게 변함.
  - 비가역함수(일방함수): 출력으로 입력을 역추적 할 수 없는 함수.
  - 충돌회피(collision resistant): 서로 다른 데이터가 동일한 해시값을 가질 확률이 거의 없음.(반대는 해시충돌)
- 해시함수 응용패턴
  - 반복해싱
  - 독립해싱
  - **결합해싱**: 독립된 데이터들을 하나로 합친 후 해시함수를 적용하여 집합에 단일한 해시값을 부여.
  - **순차적 해싱**:
  - **계층적 해싱 **: 머클트리구조와 연관.



#### 11단계: 해시값은 어디서 어떻게 사용될까?

- 사례1 | 변경-감지 방식의 `해시 참조`
  - 데이터와 그 데이터가 저장된 장소 정보를 결합하여 해시값으로 암호화. 
  - 컴퓨터 프로그램은 데이터가 저장된 장소를 기억했다가 나중에 추출하기 위해 참조값을 사용함. 이때 해시 참조는 참조값으로 **'해시값'**을 이용함.
  - 참조한 데이터가 변경된 경우 그 참조값으로는 더이상 데이터를 추출할 수 없음. 따라서 해시 참조는 참조 데이터가 만들어진 뒤로 데이터가 변경되지 않았는지 검증 해 줌. 
  - 해시 참조는 한번 생성된 이후 절대 변경 되어서는 안 되는 데이터와 관련된 모든 경우에 활용 가능.

- 사례2 | 변경-감지 방식으로 데이터 저장
  - 데이터를 저장할 때 다른 데이터를 가리키는 해시 참조를 함께 저장.
  - 가리킨 데이터가 또 다른 데이터를 가리키는 해시 참조와 함게 저장하는 방식으로 연손적으로 긴 체인을 형성할 수 있음.
  - 이 중 어느 한 데이터라도 해시 참조가 변경이 되면 전체 해시 참조가 손상되도록 만들면, 해시 참조 생성 이후 데이터가 변경되었다는 증거가 됨.
- 사례3 | 시간 소모적 계산량 유발
  - `해시퍼즐`: 각 노드의 기여도를 컴퓨터 자원의 투입량으로 평가하기 위한 문제.(비트코인에서 '작업증명'). 데이터베이스에 저장된 해법을 찾는 것이 아님. 해법은 오직 막대한 연산을 통한 **'시행착오'**를 통해서만 해결할 수 있음.
    - 변경되면 안 되는 주어진 데이터
    - nounce(난스): 자유롭게 변경 가능한 데이터
    - 적용할 해시 함수
    - 난이도(difficulty of level, 제약조건): 결합 해싱의 해시값에 주어진 제약조건.
  - 데이터와 난스를 결합한 결합 해싱의 해시값이 주어진 '난이도'를 만족시키면 그 때의 난스를 **'해답'**이라고 함. 해시 퍼즐이 복잡할수록 더 많은 계산 자원과 시간을 동원해야 해결할 수 있음.